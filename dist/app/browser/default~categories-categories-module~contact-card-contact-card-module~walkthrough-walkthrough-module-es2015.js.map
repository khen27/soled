{"version":3,"sources":["./node_modules/@capacitor-community/facebook-login/dist/esm/web.js","./node_modules/@capacitor-community/facebook-login/dist/esm/definitions.js","./src/app/facebook-provider.service.ts","./node_modules/@capacitor-community/facebook-login/dist/esm/index.js"],"names":[],"mappings":"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","file":"default~categories-categories-module~contact-card-contact-card-module~walkthrough-walkthrough-module-es2015.js","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { WebPlugin } from '@capacitor/core';\nexport class FacebookLoginWeb extends WebPlugin {\n    constructor() {\n        super({\n            name: 'FacebookLogin',\n            platforms: ['web'],\n        });\n    }\n    login(options) {\n        return __awaiter(this, void 0, void 0, function* () {\n            console.log('FacebookLoginWeb.login', options);\n            return new Promise((resolve, reject) => {\n                FB.login(response => {\n                    console.debug('FB.login', response);\n                    if (response.status === 'connected') {\n                        resolve({\n                            accessToken: {\n                                token: response.authResponse.accessToken,\n                            },\n                        });\n                    }\n                    else {\n                        reject({\n                            accessToken: {\n                                token: null,\n                            },\n                        });\n                    }\n                }, { scope: options.permissions.join(',') });\n            });\n        });\n    }\n    logout() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return new Promise(resolve => {\n                FB.logout(() => resolve());\n            });\n        });\n    }\n    getCurrentAccessToken() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return new Promise((resolve, reject) => {\n                FB.getLoginStatus(response => {\n                    if (response.status === 'connected') {\n                        const result = {\n                            accessToken: {\n                                applicationId: null,\n                                declinedPermissions: [],\n                                expires: null,\n                                isExpired: null,\n                                lastRefresh: null,\n                                permissions: [],\n                                token: response.authResponse.accessToken,\n                                userId: response.authResponse.userID,\n                            },\n                        };\n                        resolve(result);\n                    }\n                    else {\n                        reject({\n                            accessToken: {\n                                token: null,\n                            },\n                        });\n                    }\n                });\n            });\n        });\n    }\n    getProfile(options) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const fields = options.fields.join(',');\n            return new Promise((resolve, reject) => {\n                FB.api('/me', { fields }, response => {\n                    if (response.error) {\n                        reject(response.error.message);\n                        return;\n                    }\n                    resolve(response);\n                });\n            });\n        });\n    }\n}\nconst FacebookLogin = new FacebookLoginWeb();\nexport { FacebookLogin };\nimport { registerWebPlugin } from '@capacitor/core';\nregisterWebPlugin(FacebookLogin);\n//# sourceMappingURL=web.js.map","//# sourceMappingURL=definitions.js.map","import { Injectable } from '@angular/core';\r\n\r\nimport { FacebookLoginPlugin, FacebookLogin } from '@capacitor-community/facebook-login';\r\nimport { Plugins, registerWebPlugin } from '@capacitor/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { isPlatform } from '@ionic/angular';\r\nimport { parse } from 'path';\r\nregisterWebPlugin(FacebookLogin);\r\n\r\nconst { Storage } = Plugins;\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FacebookProviderService {\r\n\r\n  private fbLogin: FacebookLoginPlugin;\r\n  private user = null;\r\n  private token = null;\r\n\r\n  constructor(\r\n    private http: HttpClient\r\n  ) {\r\n    this.setupFbLogin();\r\n  }\r\n\r\n  private async setupFbLogin() {\r\n    if (isPlatform('desktop')) {\r\n      this.fbLogin = FacebookLogin;\r\n    }\r\n    else {\r\n      // Use the native imlementation inside a real app!\r\n      const { FacebookLogin } = Plugins;\r\n      this.fbLogin = FacebookLogin;\r\n    }\r\n  }\r\n\r\n  async FacebookLogin() {\r\n    console.log(\"Test 1: FacebookLogin() Starting\");\r\n    const FACEBOOK_PERMISSIONS = ['email', 'user_birthday'];\r\n    const result = await this.fbLogin.login({ permissions: FACEBOOK_PERMISSIONS });\r\n    console.log(\"Test 2: result(from fbLogin.login) != undefined ? (true) \", (result != undefined));\r\n    if (result.accessToken && result.accessToken.userId) {\r\n      this.token = result.accessToken;\r\n      this.loadUserData();\r\n    }\r\n    else if (result.accessToken && !result.accessToken.userId) {\r\n      console.log(\"Test 3: I'm on the web\");\r\n      // Web only gets the token but not the user ID\r\n      // Directly call get token to retrieve it now\r\n      await this.getCurrentToken();\r\n    }\r\n    else {\r\n      // Login failed\r\n      return false;\r\n    }\r\n    console.log(\"Test 9: Completing login. I don't believe Test 8 will have run yet, so user below is still undefined huh?\");\r\n    console.log('facebook signup, user: ', this.user);\r\n    Storage.set({\r\n      key: 'facebookCredentials',\r\n      value: JSON.stringify({\r\n        token: this.token.token,\r\n        userId: this.token.userId\r\n      })\r\n    });\r\n    //this.router.navigate(['app/categories']);\r\n    return true;\r\n  }\r\n\r\n  private async getCurrentToken() {\r\n    console.log(\"Test 4: getCurrentToken() Starting\");\r\n    const result = await this.fbLogin.getCurrentAccessToken();\r\n    console.log(\"Test 5: result(from fbLogin.GetCurrentAccessToken() != undefined ? (true) \", (result != undefined));\r\n    if (result.accessToken) {\r\n      this.token = result.accessToken;\r\n      await this.loadUserData();\r\n      console.log(\"Test 7***: this.http.get(url).subscribe(callback) is run outside of this stack I'm guessing\")\r\n    }\r\n    else {\r\n      // Not logged in.\r\n    }\r\n  }\r\n\r\n  private async loadUserData() {\r\n    console.log(\"Test 6: loadUserData() Starting\");\r\n    console.log(\"Test 7: token = \", this.token);\r\n    const url = `https://graph.facebook.com/${this.token.userId}?fields=id,name,picture.width(720),birthday,email&access_token=${this.token.token}`;\r\n    const res = await this.http.get(url).toPromise(); //.then(res => {\r\n    console.log(\"Test 8***: doing the callback outside of the observable\");\r\n    console.log('user: ', res);\r\n    this.user = res;\r\n  }\r\n\r\n  async FacebookLogout() {\r\n    this.user = null;\r\n    this.token = null;\r\n    Storage.remove( {key: 'facebookCredentials'} );\r\n    await this.fbLogin.logout().catch((error) => {\r\n      console.log(\"No access token, kick user\");\r\n    });\r\n  }\r\n\r\n  // Return a copy of the Facebook data to caller for information like user name, email, picture, etc..\r\n  public async getUser() {\r\n    if (this.user != null) { return this.user; }\r\n    let res = await this.isActiveUser();\r\n    if (res) { return this.user; }\r\n    return null;\r\n  }\r\n\r\n  private async isActiveUser() {\r\n    const ret = await Storage.get({ key: 'facebookCredentials'});\r\n    const creds = JSON.parse(ret.value);\r\n    if (creds == null) { return false; }\r\n    const url = `https://graph.facebook.com/${creds.userId}?fields=id,name,picture.width(720),birthday,email&access_token=${creds.token}`;\r\n    const res = await this.http.get(url).toPromise().catch((error) => {\r\n      console.log(\"Failed to load Facebook data, error: \", error);\r\n      Storage.remove( {key: 'facebookCredentials'});\r\n      return null;\r\n    });\r\n    if (res == null) { return false; }\r\n    console.log(\"res (from isActiveuser()): \", res);\r\n    this.user = res;\r\n    return true;\r\n  }\r\n}\r\n","export * from './definitions';\nexport * from './web';\n//# sourceMappingURL=index.js.map"],"sourceRoot":"webpack:///"}